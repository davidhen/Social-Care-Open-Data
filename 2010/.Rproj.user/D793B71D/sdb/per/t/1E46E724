{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Part 2 Social Care Survey Open Data\"\noutput:\n  html_document:\n    code_folding: hide\n    toc: yes\n---\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nknitr::opts_chunk$set(cache = TRUE)\n```\n\n```{r load_data_and_packages, message=FALSE}\nload(\"wrangled_datasets.RData\")\nlibrary(tidyverse)\nlibrary(forcats)\nlibrary(cowplot)\n```\n\n#Introduction\nIn part 1 of the open data project I imported and wrangled the data into the required format. In this part I will focus on the 2010 data and describe the distribution and missingness of the variables in the dataset for this year. It is important to remember that the 2010 data only reports on home care with observations of about 76,000 individuals. 2011 and 2012 data also reports on telecare which adds 3 variables but doubles the observations. \n\n```{r basic_plot_function}\n\n#Define Basic Plot function\nbasic_plot <- function(df, x){\n  \n  plotstats <-\n    df %>%\n    group_by_(x) %>%               \n    summarise_(count = ~n()) %>%\n    mutate_(pct = ~count/sum(count)*100)\n  \n  plot <-                   \n    ggplot(df,aes_(x = x)) +\n    geom_bar() + \n    geom_text(data = plotstats, aes(label=paste0(round(pct,1),\"%\"),\n                                        y=pct), size=3.5, vjust = -1, colour = \"sky blue\")\n  \n  plot\n\n}\n\n#Define facet_plot function\nfacet_plot <- function(df, x, y){\n  \n  plotstats <-                   \n    df %>%\n    group_by_(y, x) %>%         \n    summarise_(count = ~n()) %>%\n    mutate_(pct = ~count/sum(count)*100)\n  \n  plot <-            \n    ggplot(df,aes_(x = x)) +\n    geom_bar() + \n    facet_wrap(y, scales = \"free\") +\n    geom_text(data = plotstats, aes(label=paste0(round(pct,1),\"%\"),\n                                    y=pct), size=3.5, vjust = -1, colour = \"sky blue\")\n  plot\n  \n}\n```\n\n\n#2010 descriptives\n\nI'll start with age.\n\n##Age and Missing Data\n\n###National distribution\n\nFirst of all I'll visualise the distribution home care received by age across the country. The open data release pre-banded this variable into 5 categories.\n\n```{r Age_basic}\nbasic_age <-\n  basic_plot(hmcare2010, quote(AgeGRP)) + \n  ggtitle(\"Count of Age Group 2010\")\nbasic_age\n```\n\nHere we can see almost 75% of home care in 2010 was for the over 65s. 10% of data is missing. \n###Breakdown by Home Care\n\nThe HCclient variable is a dichotomous variable signifying whether an individual gets home care or not. If not, then the individual only gets some other form of care i.e. meals, laundry etc. I wondered if there was an age difference between these 2 groups. \n\n```{r HCclient_Age, fig.width=10}\nage_by_HCclient <- \n  facet_plot(hmcare2010, quote(AgeGRP),quote(HCclient)) + \n  ggtitle(\"Count of Age Group by HCclient 2010\")\nage_by_HCclient \n```\n\nOk, good to know - of those clients that receive home care we have virtually no missing data. The plot shows 0% but there are a few - we can code to find out how many...\n\n```{r missing_hmcare}\nhmcare2010 %>%\n  filter(HCclient == \"Yes\") %>%\n  filter(AgeGRP == \"Unknown\") %>%\n  summarise(n())\n```\n\n13 individuals. Out of a total of `r nrow(hmcare2010[hmcare2010$HCclient == \"Yes\", ])`. \n\nConversely, almost 75% of the `r nrow(hmcare2010[hmcare2010$HCclient == \"No\", ])` individuals who do not receive home care have Age data missing. I suspect the missing data will all be in the the non-home care individuals. To enable me to assess these subsets seperately I will create 2 new dataframes, One of clients with home care hours and one with clients that receive no home care hours. \n\n```{r create_hmcaredf}\nhmcare_only2010 <-           #Create new object \"hmcare_only2010\" that filters by all\n  hmcare2010 %>%             #individuals from hmcare2010 that have HCclient == \"Yes\"\n  filter(HCclient == \"Yes\")  #i.e. all those that receive home care hours. \n\nno_hmcare2010 <-             #Create a new object \"no_hmcare2010\" which contains the\n  hmcare2010 %>%             #individuals not in hmcare_only2010\n  filter(HCclient == \"No\")\n```\n\n###Missing data\n\nOk, I'd like to prove my point about the missing data being in the no home care cohort so we'lll start with this. I'll have a quick look at the dataframe to start with.\n\n```{r glimpse_no_hmcare2010}\nglimpse(no_hmcare2010)\n```\n\nSo here we can see there are `r nrow(no_hmcare2010)` observations of our `r ncol(no_hmcare2010)` variables and the first few observartions for Aberdeen City. The first few observations all receive meals service and have data for staffing (i.e. single staffed) and Housing type but all other variables (AgeGRP, ClientGRP, GenderISO) are missing. This supports my hypothesis re missing data being in this subset. I can check for sure with some easy code. All variables are factors with pre-banded groups so I can count the number of observation with each level of factor easily.\n\nAge\n```{r count_Age}\nage_table <-\n  fct_count(no_hmcare2010$AgeGRP) %>%\n  mutate(percentage = n/sum(n)*100)\nage_table\n```\n\nClientGRP\n```{r count_ClientGRP}\nClientGRP_table <-\n  fct_count(no_hmcare2010$ClientGRP) %>%\n  mutate(percentage = n/sum(n)*100)\nClientGRP_table\n```\n\nGender\n```{r count_Gender}\nGender_table <-\n  fct_count(no_hmcare2010$GenderISO) %>%\n  mutate(percentage = n/sum(n)*100)\nGender_table\n```\n\n\nSo almost exactly the same number of missing data across Age, Client group and Gender accounting for 75% of observations in the no_homcare subset. Not the greatest. \n\nFor now *I am only going to concentrate on the hmcare_only2010 dataset* i.e. the data for which individuals received some hours of home care. I can come back to the no_homecare later but it is not of most interest presently. \n\n##Home Care Only Age\n###National distribution\n\nI'll replot the Age using the hmcare_only2010 subset.\n\n```{r hmcare_only_age}\nhmcare_only_age <-\n  basic_plot(hmcare_only2010, quote(AgeGRP)) +\n  ggtitle(\"Count Home Care Age Group 2010\")\nhmcare_only_age\n```\n\nSo 67% of Home care is for people over the age of 75. Again, as we know, there are 13 individuals with missing data for age. We'll keep them in analyses for now. What does distribution look like across Local Authorities?\n\n###Distribution by Local Authority\n```{r hmcare_only_age_LA, fig.width=18, fig.height=16}\nhmcare_only_age_LA <-\n  facet_plot(hmcare_only2010, quote(AgeGRP), quote(LAcode)) +\n  ggtitle(\"Count of Age Group 2010 by Local Authority\")\nhmcare_only_age_LA\n```\n\nAt first glance the spread of older clients doesn't seem to have a pattern - I had expected larger proportions in rural LAs. I'll try a stacked bar chart.\n\n```{r stacked_age, fig.width=10}\nordered_age <-                               #Create a vector with LAs ordered by over 75s\n  AgeGRP10stats_byLA %>%\n  arrange(AgeGRP, -pct)\nordered_LAs <- ordered_age$LAcode[97:128]   #Order by 85+\n\nage_plot_stacked_age_LA <-\n  ggplot(ordered_age, aes(x = LAcode, y = pct, fill = AgeGRP)) +\n  geom_col(position = \"stack\") +\n  scale_x_discrete(limits = ordered_LAs) +   #using above vector\n  theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1)) +\n  ggtitle(\"Stacked proportions AgeGRP 2010 ordered by proportion of 85+\") +\n  xlab(\"Local Authority\") +\n  ylab(\"Perecentage receiving homecare\")\nage_plot_stacked_age_LA\n``` \nSo clearly higher proportion of home care clients are 85+ in rural areas. I wonder what it looks like if we collapse the factors to show 75-85 and 85+ together. \n\n```{r stacked_age_simplified, fig.width=10}\nhmcare_only2010_simplified <- hmcare_only2010     #Collapse the 75 - 85 and 85+ levels\nhmcare_only2010_simplified$AgeGRP <-              #in a new \"simplified\" dataframe\n  fct_collapse(hmcare_only2010_simplified$AgeGRP, \n               over75 = c(\"75-<85\", \"85+\"))\n\nAgeGRP10stats_byLA_simplified <-              #Create df with new percentage column\n  hmcare_only2010_simplified %>%                   \n  group_by(LAcode, AgeGRP) %>%   \n  summarise(count = n()) %>%     \n  mutate(pct=count/sum(count)*100)  \n\nordered_age_simplified <-                   #Create a vector with LAs ordered by over 75s\n  AgeGRP10stats_byLA_simplified %>%\n  arrange(AgeGRP, -pct)\nordered_LAs_simplified <- ordered_age_simplified$LAcode[65:96]\n\nage_plot_stacked_age_LA <-\n  ggplot(ordered_age_simplified, aes(x = LAcode, y = pct, fill = AgeGRP)) +\n  geom_col(position = \"stack\") +\n  scale_x_discrete(limits = ordered_LAs_simplified) +   #using above vector\n  theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1)) +\n  ggtitle(\"Stacked proportions AgeGRP 2010 ordered by proportion of over75s\") +\n  xlab(\"Local Authority\") +\n  ylab(\"Perecentage receiving homecare\")\nage_plot_stacked_age_LA\n```\n\nSo not much change at the left of the plot, although East Renfrewshire and Aberdeen City have jumped a few places. Interesting to see the 65-75 band does not have much variation. Changes in proportions are tend to be between the 18-65 and over 75 age groups. \n\n##Gender\nNext up to to investigate is Gender. \n\n###National Distribution\n```{r national_gender}\nGender10stats <- \n  hmcare_only2010 %>%\n  group_by(GenderISO) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\ngender_plot_national <-\n  ggplot(hmcare_only2010, aes(x = GenderISO)) +\n  geom_bar() +\n  geom_text(data = Gender10stats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=3.5, vjust = -1, colour = \"sky blue\") +\n  ggtitle(\"Count of Gender 2010 with percentage of Total\")\ngender_plot_national\n```\n\nSo, I did know there was a split but forgot is was quite as profound as that. This is reported in the annual social care survey. Why do women use more home care? Because they live longer?\n\n###Distribution by Age\n\n```{r gender_by_age}\nGender10stats_byAge <-\n  hmcare_only2010 %>%\n  group_by(AgeGRP, GenderISO) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\ngender_plot_age <-\n  ggplot(hmcare_only2010, aes(x=GenderISO)) +\n  geom_bar() +\n  facet_wrap(~AgeGRP) +\n  geom_text(data = Gender10stats_byAge, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=3.5, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of Gender 2010 with percentage of total. By Age Group\")\ngender_plot_age\n```\n\nCertainly the difference in proportions of males and females increases thorugh the age bands.\n\n###Distribution by Local Authority\n```{r Gender_by_LA, fig.width=18, fig.height=16}\nGender10stats_byLA <-\n  hmcare_only2010 %>%\n  group_by(LAcode,GenderISO) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\ngender_plot_LA <-\n  ggplot(hmcare_only2010, aes(x=GenderISO)) +\n  geom_bar() +\n  facet_wrap(~LAcode, scales = \"free\") +\n  geom_text(data = Gender10stats_byLA, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=3.5, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of Gender 2010 with percentage of total. By Local Authority\")\ngender_plot_LA\n```\n\nDistribution looks pretty consistant across LAs.\n\n##Client Group  \n\nNext up in the dataframe is Client Group. Using the metadata file published alongside the open data we can see this variable has been pre-grouped before release - presumably due to small numbers.   \n\n* Dementia and Mental Health are combined.  \n\n* \"Other\" is a combination of the Addiction, Palliative Care, Carers, and Other vulnerable groups designations. \"Carers\" itself is defined as home care provided to aid a family carer.\"Other vulnerable groups\" includes; HIV/AIDs, Aquired Brain Injury, Homeless, and Women escaping domestic violence.   \n\n* The remainin groups are; Learning Disablility, Physical Disability, Problems arising from infirmity due to age.  \n\nPublished Social Care Survey reports identify the potential for poor classification with this variable. Dementia is known to be underecorded. Also Physical Disability and Infirmity are often misclassified and can often be interchangeable.\n\n\n###National distribution\n```{r fig.height=5}\nClientGRP10stats <- \n  hmcare_only2010 %>%\n  group_by(ClientGRP) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\nclientGRP_national <-\n  ggplot(hmcare_only2010, aes(x = ClientGRP)) +\n  geom_bar() +\n  geom_text(data = ClientGRP10stats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=3.5, vjust = -1, colour = \"sky blue\") +\n  ggtitle(\"Count of Client Group 2010 with percentage of Total\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12,hjust = 1))\nclientGRP_national\n```\n\nSo pretty clearly the majority of home care is for Physical Disability and Infirmity - almost 80%. A little more missing data here but only 1.2% of the total.\n\n###Distribution by Age\n```{r client_group_by_Age, fig.width=10, fig.height=8}\nClientGRPstats_byAge <-\n  hmcare_only2010 %>%\n  group_by(AgeGRP, ClientGRP) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\nclientGRP_byAge <-\n  ggplot(hmcare_only2010, aes(x=ClientGRP)) +\n  geom_bar() +\n  facet_wrap(~AgeGRP) +\n  geom_text(data = ClientGRPstats_byAge, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=3.5, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of Client Group 2010 with percentage of total. By Age Group\") +\n  theme(axis.text.x = element_text(angle = 45, size = 6,hjust = 1))\nclientGRP_byAge\n```\n\nAs expected, there are higher numbers of learning disability in the 18-65 Age band with increasing numbers of Physical Disability and Infirmity through the Age Bands.\n\n###Distribution by Local Authority\n```{r ClientGRP_byLA, fig.width=18, fig.height=16}\nClientGRP10stats_byLA <-\n  hmcare_only2010 %>%\n  group_by(LAcode,ClientGRP) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\nclientGRP_LA <-\n  ggplot(hmcare_only2010, aes(x=ClientGRP)) +\n  geom_bar() +\n  facet_wrap(~LAcode, scales = \"free\") +\n  geom_text(data = ClientGRP10stats_byLA, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=3, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of Client Group 2010 with percentage of total. By Local Authority\")+\n  theme(axis.text.x = element_text(angle = 45, size = 6,hjust = 1))\nclientGRP_LA\n```\n\nSo here the facet plot really comes in handy. We can see massive variation in levels of each of the client groups. This is almost certainly down to classification bias - local practices vary on how clients are classified meaning comparison across LAs is impossible. e.g. virtually nobody in North Ayrshire is classified as \"Infirmity due to Age\", whilst in the Scottish Borders almost everybody is in this group. This variable would be of no use as a comparator. Missingness seems to be distributed fairly evenly across 13 council areas; Aberdeenshire, Angus, East Dunbartonshire, Edinburgh, City of, Eilean Siar, Falkirk, Fife, Glasgow City, Highland, Moray, Perth & Kinross, Renfrewshire, and Stirling. Renfrewshire has the highest proportion of missing data at 5.6%.  To illustrate the variation in classification a little better, let's use a stacked bar chart again.\n\n```{r clientGRP_stacked, fig.width=10}\nordered_clientGRP <- \n  ClientGRP10stats_byLA%>%\n  arrange(ClientGRP, pct)\nordered_LAs_ClientGRP <- ordered_clientGRP$LAcode[65:96]\n\nclientGRP_stacked <-\n  ggplot(ClientGRP10stats_byLA, aes(x = LAcode, y = pct, fill = ClientGRP)) +\n  geom_col(position = \"stack\") +\n  theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1)) +\n  scale_x_discrete(limits = rev(ordered_LAs_ClientGRP)) +\n  ggtitle(\"Stacked proportions Client Group 2010 ordered by physical disability\") +\n  xlab(\"Local Authority\") +\n  ylab(\"Perecentage receiving homecare\")\nclientGRP_stacked\n```\n\nSo, for example, almost everybody in Aberdeenshire and P & K get home care for Infirmity and hardly anyone for Physical disability, whereas the opposite is true in Orkney and North Ayrshire. Clearly this can't refelct reality and the issue is with the classification reporting. \n\n##Home Care Hours\nVariable of most interest! Again this variable was banded pre-publication of the data. If I'm honest they aren't the most helpful bandings - something more ordinal would have been better e.g. some bands describe a value between 2hrs of home care, others between 5hrs of home care (\"2-4\", \"5-10\"). The home care hours data is provided with 5 variables; number of Local Authority provided hours, Private provided hours, Voluntary Organisation provided hours, Personal Care Hours, and Total hours. There are some people who will receive a variety of these and I may turn to this as a sub-group later. For the moment I will concentrate on total figures. I am filtering out data where the bandHRS variable = \"Zero\" in the following plots to aid analysis. I am also not plotting anything relating to Personal Care hours because nobody in the 2010 dataset received (or was recorded as receiving) Personal Care. We can show this with the follwing code.\n\n```{r bandHRSPC}\nPChrs <-\n  hmcare_only2010 %>%\n  filter(bandHRSPC == \"Zero\") %>%       #Identify everyone who had Zero value for PC hours\n  summarise(n())                        #Count how many observations have this value\nPChrs\n\nPChrs == length(hmcare_only2010$bandHRSPC)  #Is the number of observation with Zero equal to the total number of observations in the dataset?\n```\n\nOk let's plot the data we do have. I'll create 4 seperate plots for each variable then combine them into 1 plot. \n\n###National Distribution\n\n```{r national_bandHRSTT}\nbandHRSTT10stats <- \n  hmcare_only2010 %>%\n  filter(bandHRSTT != \"Zero\") %>%\n  group_by(bandHRSTT) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\nhmcare_national <-\n  hmcare_only2010 %>%\n  filter(bandHRSTT != \"Zero\") %>%\n  ggplot(aes(x = bandHRSTT)) +\n  geom_bar() +\n  geom_text(data = bandHRSTT10stats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=2.5, vjust = -1, colour = \"sky blue\") +\n  geom_text(data = bandHRSTT10stats, aes(label=paste0(\"Total number = \",sum(count)),\n                                         x = Inf, y= Inf, hjust = 1, vjust = 3)) +\n  ggtitle(\"Count of Total Home Care Hours 2010\") +\n  xlab(\"Number of hours of Home Care\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12,hjust = 1))\n```\n\n```{r bandLAHRS}\nbandHRSLA10stats <- \n  hmcare_only2010 %>%\n  filter(bandHRSLA != \"Zero\") %>%\n  group_by(bandHRSLA) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\nhmcare_LA <-\n  hmcare_only2010 %>%\n  filter(bandHRSLA != \"Zero\") %>%\n  ggplot(aes(x = bandHRSLA)) +\n  geom_bar() +\n  geom_text(data = bandHRSLA10stats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=2.5, vjust = -1, colour = \"sky blue\") +\n  geom_text(data = bandHRSLA10stats, aes(label=paste0(\"Total number = \",sum(count)),\n                                         x = Inf, y= Inf, hjust = 1, vjust = 3)) +\n  ggtitle(\"Count of LA provided Home Care Hours 2010\") +\n  xlab(\"Number of hours of Home Care\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12,hjust = 1))\n\n```\n\n```{r bandHRSpri}\nbandHRSpri10stats <- \n  hmcare_only2010 %>%\n  filter(bandHRSpri != \"Zero\") %>%\n  group_by(bandHRSpri) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\nhmcare_pri <-\n  hmcare_only2010 %>%\n  filter(bandHRSpri != \"Zero\") %>%\n  ggplot(aes(x = bandHRSpri)) +\n  geom_bar() +\n  geom_text(data = bandHRSpri10stats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=2.5, vjust = -1, colour = \"sky blue\") +\n  geom_text(data = bandHRSpri10stats, aes(label=paste0(\"Total number = \",sum(count)),\n                                         x = Inf, y= Inf, hjust = 1, vjust = 3)) +\n  ggtitle(\"Count of Private provided Home Care Hours 2010\") +\n  xlab(\"Number of hours of Home Care\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12,hjust = 1))\n```\n\n```{r bandHRSvol}\nbandHRSvol10stats <- \n  hmcare_only2010 %>%\n  filter(bandHRSvol != \"Zero\") %>%\n  group_by(bandHRSvol) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\nhmcare_vol<-\n  hmcare_only2010 %>%\n  filter(bandHRSvol != \"Zero\") %>%\n  ggplot(aes(x = bandHRSvol)) +\n  geom_bar() +\n  geom_text(data = bandHRSvol10stats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=2.5, vjust = -1, colour = \"sky blue\") +\n  geom_text(data = bandHRSvol10stats, aes(label=paste0(\"Total number = \",sum(count)),\n                                         x = Inf, y= Inf, hjust = 1, vjust = 2)) +\n  ggtitle(\"Count of Voluntary Organisation provided Home Care Hours 2010\") +\n  xlab(\"Number of hours of Home Care\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12,hjust = 1))\n```\n\n\n\n```{r hmcareplot, fig.width=6, fig.height=10, message=FALSE, warning=FALSE}\nplot_grid(hmcare_national, hmcare_LA, hmcare_pri, hmcare_vol, ncol = 1)\n```\n\nImportant to note the y-axis varies with each of these plots. I've added totals to keep things in perspective. The top left plot is the combination of all hours of home care provided. The other 3 plots are breakdowns by provider - LA, Private, and Voluntary. \n\nMore recent reports on the Social Care Survey suggest that private and voluntary organisations tend to provide care for larger care packages (i.e. over 10 hrs.). This seems to be the case here but is difficult to se as it is a busy plot.  I'd like to simplify these plots a little. Before I looked at the data I had thought I'd like to bin the hours into 0-5, 5-10, 10-15, 15-20, and 20 plus. Because of the way this data is grouped I can't do that. For now I'll go for 0-4 and 4-10 then carry on.\n\n```{r simplify_bandHRS, warning=FALSE}\n\nhmcare_only2010_simplified$bandHRSLA <- \n  fct_collapse(hmcare_only2010_simplified$bandHRSLA, \n               `<4` = c(\"<1\", \"1-2\", \"2-4\"),\n               `4-10` = c(\"4-6\", \"6-8\", \"8-10\"),\n               over20 = c(\"20-30\", \"30-40\", \"40-50\", \"over50\"))\n\nhmcare_only2010_simplified$bandHRSpri <- \n  fct_collapse(hmcare_only2010_simplified$bandHRSpri, \n               `<4` = c(\"<1\", \"1-2\", \"2-4\"),\n               `4-10` = c(\"4-6\", \"6-8\", \"8-10\"),\n               over20 = c(\"20-30\", \"30-40\", \"40-50\", \"over50\"))\n\nhmcare_only2010_simplified$bandHRSvol <- \n  fct_collapse(hmcare_only2010_simplified$bandHRSvol, \n               `<4` = c(\"<1\", \"1-2\", \"2-4\"),\n               `4-10` = c(\"4-6\", \"6-8\", \"8-10\"),\n               over20 = c(\"20-30\", \"30-40\", \"40-50\", \"over50\"))\n\nhmcare_only2010_simplified$bandHRSTT <- \n  fct_collapse(hmcare_only2010_simplified$bandHRSTT, \n               `<4` = c(\"<1\", \"1-2\", \"2-4\"),\n               `4-10` = c(\"4-6\", \"6-8\", \"8-10\"),\n               over20 = c(\"20-30\", \"30-40\", \"40-50\", \"over50\"))\n\nhmcare_only2010_simplified$bandHRSPC <- \n  fct_collapse(hmcare_only2010_simplified$bandHRSPC, \n               `<4` = c(\"<1\", \"1-2\", \"2-4\"),\n               `4-10` = c(\"4-6\", \"6-8\", \"8-10\"),\n               over20 = c(\"20-30\", \"30-40\", \"40-50\", \"over50\"))\n```\n\nOk, now I'll replot the above with the simplified levels. \n\n```{r bandHRSTT_simplified}\nbandHRSTT10_simplifiedstats <- \n  hmcare_only2010_simplified %>%\n  filter(bandHRSTT != \"Zero\") %>%\n  group_by(bandHRSTT) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\nhmcare_national_simplified <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSTT != \"Zero\") %>%\n  ggplot(aes(x = bandHRSTT)) +\n  geom_bar() +\n  geom_text(data = bandHRSTT10_simplifiedstats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=5, vjust = -1, colour = \"sky blue\") +\n  geom_text(data = bandHRSTT10_simplifiedstats, \n            aes(label=paste0(\"Total number = \",sum(count)), x = Inf, y= Inf, \n                hjust = 1, vjust = 3)) +\n  ggtitle(\"Count of Total Home Care Hours 2010\") +\n  xlab(\"Number of hours of Home Care\") +\n  theme(axis.text.x = element_text(size = 12,hjust = 1))\n```\n\n```{r bandHRSLA_simplified}\nbandHRSLA10_simplifiedstats <- \n  hmcare_only2010_simplified %>%\n  filter(bandHRSLA != \"Zero\") %>%\n  group_by(bandHRSLA) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\nhmcare_LA_simplified <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSLA != \"Zero\") %>%\n  ggplot(aes(x = bandHRSLA)) +\n  geom_bar() +\n  geom_text(data = bandHRSLA10_simplifiedstats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=5, vjust = -1, colour = \"sky blue\") +\n  geom_text(data = bandHRSLA10_simplifiedstats, \n            aes(label=paste0(\"Total number = \",sum(count)), x = Inf, y= Inf, \n                hjust = 1, vjust = 3)) +\n  ggtitle(\"Count of LA provided Home Care Hours 2010\") +\n  xlab(\"Number of hours of Home Care\") +\n  theme(axis.text.x = element_text(size = 12,hjust = 1))\n\n```\n\n```{r bandHRSpri_simplified}\nbandHRSpri10_simplifiedstats <- \n  hmcare_only2010_simplified %>%\n  filter(bandHRSpri != \"Zero\") %>%\n  group_by(bandHRSpri) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\nhmcare_pri_simplified <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSpri != \"Zero\") %>%\n  ggplot(aes(x = bandHRSpri)) +\n  geom_bar() +\n  geom_text(data = bandHRSpri10_simplifiedstats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=5, vjust = -1, colour = \"sky blue\") +\n  geom_text(data = bandHRSpri10_simplifiedstats, \n            aes(label=paste0(\"Total number = \",sum(count)), x = Inf, y= Inf,\n                hjust = 1, vjust = 3)) +\n  ggtitle(\"Count of Private provided Home Care Hours 2010\") +\n  xlab(\"Number of hours of Home Care\") +\n  theme(axis.text.x = element_text(size = 12,hjust = 1))\n```\n\n```{r bandHRSvol_simplified}\nbandHRSvol10_simplifiedstats <- \n  hmcare_only2010_simplified %>%\n  filter(bandHRSvol != \"Zero\") %>%\n  group_by(bandHRSvol) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count)*100)\n\nhmcare_vol_simplified<-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSvol != \"Zero\") %>%\n  ggplot(aes(x = bandHRSvol)) +\n  geom_bar() +\n  geom_text(data = bandHRSvol10_simplifiedstats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size= 5, vjust = -1, colour = \"sky blue\") +\n  geom_text(data = bandHRSvol10_simplifiedstats,\n            aes(label=paste0(\"Total number = \",sum(count)), x = Inf, y= Inf,\n                hjust = 1, vjust = 2)) +\n  ggtitle(\"Count of Voluntary Organisation provided Home Care Hours 2010\") +\n  xlab(\"Number of hours of Home Care\") +\n  theme(axis.text.x = element_text(size = 12,hjust = 1))\n```\n\n\n\n```{r hmcareplot_simplified, fig.width=6, fig.height=10}\nlibrary(cowplot)\nplot_grid(hmcare_national_simplified, hmcare_LA_simplified, hmcare_pri_simplified,\n          hmcare_vol_simplified, ncol = 1)\n```\n\n\nSo this makes the distinction a lot esasier to see. With this simplified plot we can see Local Authorities on the whole tend to concentrate on providing smaller care packages with the private, and particularly voluntary, sectors picking up a greater proportion of the larger packages of care. \n\n###Distribution by Age\n\nWith these simplified groups I'll now have a look at the distribution of Total number of home care hours by Age Group\n\n```{r bandHRSTT_by_Age, fig.width=8, fig.height=9}\nbandHRSTTstats_byAge <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSTT != \"Zero\") %>%\n  filter(AgeGRP != \"Unknown\") %>%\n  group_by(AgeGRP, bandHRSTT) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\nbandHRSTT_byAge <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSTT != \"Zero\") %>%\n  filter(AgeGRP != \"Unknown\") %>%\n  ggplot(aes(x=bandHRSTT)) +\n  geom_bar() +\n  facet_wrap(~AgeGRP, scales = \"free\") +\n  geom_text(data = bandHRSTTstats_byAge, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=2.5, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of Total Home Care Hours 2010. By Age Group\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12, hjust = 1))\n\nbandHRSLAstats_byAge <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSLA != \"Zero\") %>%\n  filter(AgeGRP != \"Unknown\") %>%\n  group_by(AgeGRP, bandHRSLA) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\nbandHRSLA_byAge <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSLA != \"Zero\") %>%\n  filter(AgeGRP != \"Unknown\") %>%\n  ggplot(aes(x=bandHRSLA)) +\n  geom_bar() +\n  facet_wrap(~AgeGRP, scales = \"free\") +\n  geom_text(data = bandHRSLAstats_byAge, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=2.5, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of LA provided Home Care Hours 2010. By Age Group\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12, hjust = 1))\n\nbandHRSpristats_byAge <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSpri != \"Zero\") %>%\n  filter(AgeGRP != \"Unknown\") %>%\n  group_by(AgeGRP, bandHRSpri) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\nbandHRSpri_byAge <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSpri != \"Zero\") %>%\n  filter(AgeGRP != \"Unknown\") %>%\n  ggplot(aes(x=bandHRSpri)) +\n  geom_bar() +\n  facet_wrap(~AgeGRP, scales = \"free\") +\n  geom_text(data = bandHRSpristats_byAge, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=2.5, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of Private Home Care Hours 2010. By Age Group\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12, hjust = 1))\n\nbandHRSvolstats_byAge <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSvol != \"Zero\") %>%\n  filter(AgeGRP != \"Unknown\") %>%\n  group_by(AgeGRP, bandHRSvol) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\nbandHRSvol_byAge <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSvol != \"Zero\") %>%\n  filter(AgeGRP != \"Unknown\") %>%\n  ggplot(aes(x=bandHRSvol)) +\n  geom_bar() +\n  facet_wrap(~AgeGRP, scales = \"free\") +\n  geom_text(data = bandHRSvolstats_byAge, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=2.5, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of Voluntary Home Care Hours 2010. By Age Group\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12, hjust = 1))\n\nplot_grid(bandHRSTT_byAge, bandHRSLA_byAge, bandHRSpri_byAge, bandHRSvol_byAge, ncol = 1)\n```\n\nSo we can see this trend is pretty consitant across age bands - The proportion of LA provided hours are much higher in the lower, particularly <4 hr, care packages but provide much more absolute hours of care.. The voluntary sector provides significantly higher proportions of over 20hr care packages across all ages, but with lowest absolute hours of care.\n\n###Distribution by Gender\n\nI'll just look at the Total hours by Gender.\n\n```{r bandHRSTT_by_Gender}\nbandHRSTTstats_byGender <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSTT != \"Zero\") %>%\n  group_by(GenderISO, bandHRSTT) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\nbandHRSTT_byGender <-\n  hmcare_only2010_simplified %>%\n  filter(bandHRSTT != \"Zero\") %>%\n  ggplot(aes(x=bandHRSTT)) +\n  geom_bar() +\n  facet_wrap(~GenderISO, scales = \"free\") +\n  geom_text(data = bandHRSTTstats_byGender, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=2.5, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of Total Home Care Hours 2010. By Gender\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12, hjust = 1))\nbandHRSTT_byGender\n```\n\nSo the distibution across gender seems pretty similar with a slight increase in the proportion of Men getting over 20 hr packages.(Wild stab in the dark - More men with Aquired Brain injury from traffic accidents/fights etc). \n\n###Distribution across Local Authorities\n\nThe next really interesting question is how home care hours vary across LAs. For now we will stick to the Total hours only and leave out the breakdown by provider. \n\n```{r bandHRSTT_byLA, fig.height=16, fig.width=18, warning=FALSE}\n\nbandHRSTT10stats_byLA <-           \n  hmcare_only2010_simplified %>% \n  group_by(LAcode, bandHRSTT) %>%    \n  summarise(count = n()) %>%      \n  mutate(pct=count/sum(count)*100)  \n\nbandHRSTTplot_LA <-\n  hmcare_only2010_simplified %>%\n  ggplot(aes(x = bandHRSTT)) +   \n  geom_bar() +\n  facet_wrap(~LAcode, scales = \"free\") +\n  geom_text(data = bandHRSTT10stats_byLA, aes(label=paste0(round(pct,1),\"%\"), y=pct),\n            size=2.5, vjust = -1, colour = \"sky blue\") + \n  ggtitle(\"Count of Total home care hours 2010 with percentage of total. By Local Authority\")\nbandHRSTTplot_LA\n```\n\nOk. Some really big variations here. Particularly in the <4hrs banding - from 20% in Dumfries & Galloway to 70% in Angus.\n\nAgain, a stacked bar chart will be useful here...\n\n```{r stacked_bandHRSTT, fig.width=10}\nordered_bandHRSTT <-                   #Create a vector with LAs ordered by over 75s\n  bandHRSTT10stats_byLA %>%\n  arrange(bandHRSTT, -pct)\nordered_LAs_bandHRSTT <- ordered_bandHRSTT$LAcode[1:32] # Order by <4\n\nbandHRSTT_stacked_LA <-\n  ggplot(bandHRSTT10stats_byLA, aes(x = LAcode, y = pct, fill = bandHRSTT)) +\n  geom_col(position = \"stack\") +\n  scale_x_discrete(limits = ordered_LAs_bandHRSTT) +   #using above vector\n  theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1)) +\n  ggtitle(\"Stacked proportions Total Home Care Hours 2010 ordered by proportion of <4hrs\") +\n  xlab(\"Local Authority\") +\n  ylab(\"Perecentage receiving homecare\")\nbandHRSTT_stacked_LA\n```\n\nCertainly shows the variation nicely! \n\nI'll try and see if Age has any impact on this variation. \n```{r stacked_bandHRSTT_with_Age_facet, fig.width=18, fig.height=12}\nbandHRSTT10stats_byLA_byAge <-\n  hmcare_only2010_simplified %>%\n  filter(HCclient == \"Yes\") %>%\n  group_by(LAcode,AgeGRP, bandHRSTT) %>%\n  summarise(count = n()) %>%\n  mutate(pct = count/sum(count) * 100)\n\nbandHRSTT_stacked_LA_byAge <-\n  bandHRSTT10stats_byLA_byAge %>%\n  filter(bandHRSTT != \"Zero\") %>%\n  filter(AgeGRP != \"Unknown\") %>%\n  ggplot(aes(x = LAcode, y = pct, fill = bandHRSTT)) +\n  geom_col(position = \"stack\") +\n  facet_grid(AgeGRP ~ .) +\n  geom_hline(yintercept = 50) +\n  scale_x_discrete(limits = ordered_LAs_bandHRSTT) +\n  ggtitle(\"Stacked proportions Total Hours of Home Care 2010 by Age Band\") +\n  xlab(\"Local Authority\") +\n  ylab(\"Perecentage receiving homecare\") +\n  theme(plot.title = element_text(size = 18, face = \"bold\")) +\n  theme(axis.text.x = element_text(angle = 45, size = 12,hjust = 1)) +\n  theme(axis.title = element_text(size = 14)) +\n  theme(strip.text.y = element_text(size=12, face=\"bold\"))\nbandHRSTT_stacked_LA_byAge\n```\n\nSo because there are only individuals who get Home care and have an \"Unknown\" Age I have removed them from this plot. I have kept the x-axis ordered by the TOTAL proportion <4hrs care as in the plot above. There is only some slight variation in the 18-65 age band but the order is fairly consistant with the Total plot. The other 2 Age bands show very close resemblance to the total plot.\n\n\n##Living arrangements\n\n###National Distribution\n\nWhat are the living arrangements of those receiving Home Care?\n\n```{r living_arrangements}\nLivingArrstats <-                      #Create a table with summary stats to use as labels\n  hmcare_only2010 %>%                  #in the plot\n  group_by(LivingArr) %>%              #Group main df by LivingArr\n  summarise(count = n()) %>%           #Count individuals in each age group - new column\n  mutate(pct = count/sum(count)*100)   #New column - with percentage calculated\n\nLivingArr_plot_national <-                   #Plot Age group from main hmcare2010 df. \n  ggplot(hmcare_only2010,aes(x = LivingArr)) +\n  geom_bar() + \n  geom_text(data = LivingArrstats, aes(label=paste0(round(pct,1),\"%\"), #Add labels from above\n                               y=pct), size=3.5, vjust = -1, colour = \"sky blue\") +\n  ggtitle(\"Count of Living Arrangements 2010.\")\nLivingArr_plot_national\n```\n\nSo the pre-banding isn't helpful here - Data is collected on sheltered housing and care homes I believe. It is possible numbers are so small that they cannot be disclosed. Quite a bit of missing data here. Any Age or Gender more likely to be missing?\n\n###Distribution by Age\n```{r living_arrangements_byAge}\nLivingArr_byAgestats <-                #Create a table with summary stats to use as labels\n  hmcare_only2010 %>%                  #in the plot\n  group_by(AgeGRP, LivingArr) %>%      #Group main df by Age and LivingArr\n  summarise(count = n()) %>%           #Count individuals in each age group - new column\n  mutate(pct = count/sum(count)*100)   #New column - with percentage calculated\n\nLivingArr_byAge_plot_national <-        #Plot Age group from main hmcare2010 df. \n  ggplot(hmcare_only2010,aes(x = LivingArr)) +\n  geom_bar() + \n  facet_wrap(~AgeGRP) +\n  geom_text(data = LivingArr_byAgestats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=3.5, vjust = -1, colour = \"sky blue\") +\n  theme(axis.text.x = element_text(angle = 45, size = 12,hjust = 1)) +\n  ggtitle(\"Count of Living Arrangements by Age Group\")\nLivingArr_byAge_plot_national\n```\n\nSo similar amount of missing data here across Age groups. What about Gender?\n\n###Distribution by Gender\n```{r living_arrangements_byGender}\nLivingArr_byGenderstats <-             #Create a table with summary stats to use as labels\n  hmcare_only2010 %>%                  #in the plot\n  group_by(GenderISO, LivingArr) %>%   #Group main df by Age and LivingArr\n  summarise(count = n()) %>%           #Count individuals in each age group - new column\n  mutate(pct = count/sum(count)*100)   #New column - with percentage calculated\n\nLivingArr_byGender_plot_national <-        #Plot Age group from main hmcare2010 df. \n  ggplot(hmcare_only2010,aes(x = LivingArr)) +\n  geom_bar() + \n  facet_wrap(~GenderISO) +\n  geom_text(data = LivingArr_byGenderstats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=3.5, vjust = -1, colour = \"sky blue\") +\n  ggtitle(\"Count of Living Arrangements by Age Group\")\nLivingArr_byGender_plot_national\n```\n\nSo women getting home care are more liekly to be living alone. No major difference in missingness - are there certain LAs more culpable??\n\n###Distribution by LA\n```{r living_arrangements_byLA, fig.width=16, fig.height=18}\nLivingArr_byLAstats <-             #Create a table with summary stats to use as labels\n  hmcare_only2010 %>%                  #in the plot\n  group_by(LAcode, LivingArr) %>%   #Group main df by Age and LivingArr\n  summarise(count = n()) %>%           #Count individuals in each age group - new column\n  mutate(pct = count/sum(count)*100)   #New column - with percentage calculated\n\nLivingArr_byLA_plot_national <-        #Plot Age group from main hmcare2010 df. \n  ggplot(hmcare_only2010,aes(x = LivingArr)) +\n  geom_bar() + \n  facet_wrap(~LAcode, scales = \"free\") +\n  geom_text(data = LivingArr_byLAstats, aes(label=paste0(round(pct,1),\"%\"),\n                               y=pct), size=3.5, vjust = -1, colour = \"sky blue\") +\n  ggtitle(\"Count of Living Arrangements by Age Group\")\nLivingArr_byLA_plot_national\n```\n\nOk, so not many with good pass marks here! Wide variation. Also data quality issues e.g. Renfrewshire, or Stirling - 75+% \"Other\" and approx 20% \"Lives Alone\"?? Completely at odds with national average - more likely to be missing data. We'll stack it just to get a good visualisation.\n\nAll-in-all another unreliable variable I would say. \n\n\n##Other services\nHow many clients that receive home care also receive another service?\n\n###Meals\n```{r count_meals}\nfct_count(hmcare_only2010$meals)\n```\n\n###",
    "created" : 1487369914672.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "486646824",
    "id" : "1E46E724",
    "lastKnownWriteTime" : 1487372495,
    "last_content_update" : 1487372495746,
    "path" : "C:/Users/hedgi/Google Drive/Uni/Multimorb PhD/Analysis/soc_care_open_data/2010/Part2_2010_Report.Rmd",
    "project_path" : "Part2_2010_Report.Rmd",
    "properties" : {
        "last_setup_crc32" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}