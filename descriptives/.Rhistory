ggplot(stackstats, aes(x = LAcode, y = pct, fill = bandHRSTT)) +
geom_col(position = "stack") +
scale_x_discrete(limits = ordered_LAs) +   #using above vector
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1)) +
ggtitle("Total Home Care Hours 2010-2012, ordered by proportion of <4hrs") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare")
bandHRSTT_stacked_LA
stackstats <-
hmcare_alldata_simplified %>%
group_by(LAcode, bandHRSTT) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_bandHRSTT <-                   #Create a vector with LAs ordered by <4hrs
stackstats %>%
arrange(bandHRSTT, -pct)
ordered_LAs <- ordered_bandHRSTT$LAcode[1:32] # Order by <4
bandHRSTT_stacked_LA <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = bandHRSTT)) +
geom_col(position = "stack") +
scale_x_discrete(limits = ordered_LAs) +   #using above vector
ggtitle("Total Home Care Hours 2010-2012, ordered by proportion of <4hrs") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare") +
theme_economist() +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1))
bandHRSTT_stacked_LA
stackstats <-
hmcare_alldata_simplified %>%
group_by(LAcode, bandHRSTT) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_bandHRSTT <-                   #Create a vector with LAs ordered by <4hrs
stackstats %>%
arrange(bandHRSTT, -pct)
ordered_LAs <- ordered_bandHRSTT$LAcode[1:32] # Order by <4
bandHRSTT_stacked_LA <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = bandHRSTT)) +
geom_col(position = "stack") +
scale_x_discrete(limits = ordered_LAs) +   #using above vector
ggtitle("Total Home Care Hours 2010-2012, ordered by proportion of <4hrs") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare") +
theme_economist() +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1))
bandHRSTT_stacked_LA
bandHRSTT_by_ClientGRP <-
facet_plot(hmcare_alldata_simplified, quote(bandHRSTT), quote(ClientGRP)) +
ggtitle("Total home care hours 2010-2012, by Client Group")
bandHRSTT_by_ClientGRP
bandHRSTT_by_ClientGRP_and_Agegroup <-
multifacet_plot(hmcare_alldata_simplified, quote(bandHRSTT), quote(AgeGRP),
quote(ClientGRP)) +
ggtitle("Total Home Care Hours 2010-2012, by Client Group and Age Group")
bandHRSTT_by_ClientGRP_and_Agegroup
meals_national <-
facet_plot(hmcare_alldata, quote(meals), quote(year)) +
ggtitle("Meals for home care clients, by year")
meals_national
meals_by_LA_2010 <-
facet_plot(hmcare_sc10, quote(meals), quote(LAcode)) +
ggtitle("Meals for home care clients 2010, by Local Authority")
meals_by_LA_2010
meals_by_LA_2011 <-
facet_plot(hmcare_sc11, quote(meals), quote(LAcode)) +
ggtitle("Meals for home care clients 2011, by Local Authority")
meals_by_LA_2011
meals_by_LA_2012 <-
facet_plot(hmcare_sc12, quote(meals), quote(LAcode)) +
ggtitle("Meals for home care clients 2012, by Local Authority")
meals_by_LA_2012
LivingArr_national <-
facet_plot(hmcare_alldata, quote(LivingArr), quote(year)) +
ggtitle("Living Arrangments of Home care clients, by year")
LivingArr_national
LivingArr_byLA <-
facet_plot(hmcare_alldata, quote(LivingArr), quote(LAcode)) +
ggtitle("Living Arrangements Home Care Clients, by Local Authority")
LivingArr_byLA
Staff_national <-
facet_plot(hmcare_alldata, quote(Staff), quote(year)) +
ggtitle("Staffing for home care clients, by year")
Staff_national
Staff_byAge_andGender <-
multifacet_plot(hmcare_alldata, quote(Staff), quote(GenderISO), quote(AgeGRP)) +
ggtitle("Staffing for Home care clients, by Age and Gender")
Staff_byAge_andGender
Staff_byGender_andAge <-
multifacet_plot(hmcare_alldata, quote(Staff), quote(AgeGRP), quote(GenderISO)) +
ggtitle("Staffing for Home care clients, by Gender and Age")
Staff_byGender_andAge
Staff_by_ClientGRP <-
facet_plot(hmcare_alldata, quote(Staff), quote(ClientGRP)) +
ggtitle("Staffing for Home Care Clients, by Client Group")
Staff_by_ClientGRP
Staff_by_LA <-
facet_plot(hmcare_alldata, quote(Staff), quote(LAcode)) +
ggtitle("Staffing for home care clients, by Local Authority")
Staff_by_LA
stackstats <-
hmcare_alldata %>%
group_by(LAcode, Staff) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_Staff <-                   #Create a vector with LAs ordered by <4hrs
stackstats %>%
arrange(Staff, -pct)
ordered_LAs <- ordered_Staff$LAcode[1:32] # Order by <4
Staff_stacked_LA <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = Staff)) +
geom_col(position = "stack") +
scale_x_discrete(limits = ordered_LAs) +   #using above vector
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1)) +
ggtitle("Staffing for Home Care Clients, ordered by 2 or more staff") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare")
Staff_stacked_LA
stackstats <-
hmcare_alldata %>%
group_by(LAcode, Staff) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_Staff <-                   #Create a vector with LAs ordered by <4hrs
stackstats %>%
arrange(Staff, -pct)
ordered_LAs <- ordered_Staff$LAcode[1:32] # Order by <4
Staff_stacked_LA <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = Staff)) +
geom_col(position = "stack") +
scale_x_discrete(limits = ordered_LAs) +   #using above vector
ggtitle("Staffing for Home Care Clients, ordered by 2 or more staff") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare") +
theme_economist() +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1))
Staff_stacked_LA
stackstats <-
hmcare_alldata %>%
group_by(LAcode, Staff) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_Staff <-                   #Create a vector with LAs ordered by <4hrs
stackstats %>%
arrange(Staff, -pct)
ordered_LAs <- ordered_Staff$LAcode[1:32] # Order by <4
Staff_stacked_LA <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = Staff)) +
geom_col(position = "stack") +
scale_x_discrete(limits = ordered_LAs) +   #using above vector
ggtitle("Staffing for Home Care Clients, ordered by 2 or more staff") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare") +
theme_economist() +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1))
Staff_stacked_LA
HousingType_OV_national <-
facet_plot(hmcare_alldata, quote(HousingType_OV), quote(year)) +
theme(axis.text.x = element_text(angle = 45, size = 10)) +
ggtitle("Housing Type of Home care clients, by year")
HousingType_OV_national
HousingType_OV_national <-
facet_plot(hmcare_alldata, quote(HousingType_OV), quote(year)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing Type of Home care clients, by year")
HousingType_OV_national
#2010
Housing_byAge_andGender10 <-
multifacet_plot(hmcare_sc10, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2010, by Age and Gender")
#2011
Housing_byAge_andGender11 <-
multifacet_plot(hmcare_sc11, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2011, by Age and Gender")
#2012
Housing_byAge_andGender12 <-
multifacet_plot(hmcare_sc12, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2012, by Age and Gender")
plot_grid(Housing_byAge_andGender10, Housing_byAge_andGender11,
Housing_byAge_andGender12, ncol = 1)
#2010
Housing_byAge_andGender10 <-
multifacet_plot(hmcare_sc10, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2010, by Age and Gender")
#2011
Housing_byAge_andGender11 <-
multifacet_plot(hmcare_sc11, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2011, by Age and Gender")
#2012
Housing_byAge_andGender12 <-
multifacet_plot(hmcare_sc12, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2012, by Age and Gender")
plot_grid(Housing_byAge_andGender10, Housing_byAge_andGender11,
Housing_byAge_andGender12, ncol = 1)
#2010
Housing_byAge_andGender10 <-
multifacet_plot(hmcare_sc10, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2010, by Age and Gender")
#2011
Housing_byAge_andGender11 <-
multifacet_plot(hmcare_sc11, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2011, by Age and Gender")
#2012
Housing_byAge_andGender12 <-
multifacet_plot(hmcare_sc12, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2012, by Age and Gender")
plot_grid(Housing_byAge_andGender10, Housing_byAge_andGender11,
Housing_byAge_andGender12, ncol = 1)
#2010
Housing_byAge_andGender10 <-
multifacet_plot(hmcare_sc10, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2010, by Age and Gender")
#2011
Housing_byAge_andGender11 <-
multifacet_plot(hmcare_sc11, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2011, by Age and Gender")
#2012
Housing_byAge_andGender12 <-
multifacet_plot(hmcare_sc12, quote(HousingType_OV), quote(AgeGRP),
quote(GenderISO)) +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1)) +
ggtitle("Housing type Home care Clients 2012, by Age and Gender")
plot_grid(Housing_byAge_andGender10, Housing_byAge_andGender11,
Housing_byAge_andGender12, ncol = 1)
stackstats <-
hmcare_alldata %>%
group_by(LAcode, year, HousingType_OV) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_housing <-
stackstats %>%
arrange(year, -pct)
ordered_LAs <- ordered_housing$LAcode[1:32]  #Order by Female over75s
Housing_byLA_byyear_stacked <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = HousingType_OV)) +
geom_col(position = "stack") +
facet_grid(year ~ .) +
scale_x_discrete(limits = ordered_LAs) +#using above vector
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1)) +
ggtitle("Stacked proportions Housing Type, ordered by proportion ...") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare")
Housing_byLA_byyear_stacked
stackstats <-
hmcare_alldata %>%
group_by(LAcode, year, HousingType_OV) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_housing <-
stackstats %>%
arrange(year, -pct)
ordered_LAs <- ordered_housing$LAcode[1:32]  #Order by Female over75s
Housing_byLA_byyear_stacked <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = HousingType_OV)) +
geom_col(position = "stack") +
facet_grid(year ~ .) +
scale_x_discrete(limits = ordered_LAs) +#using above vector
ggtitle("Stacked proportions Housing Type, ordered by proportion ...") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare") +
theme_economist() +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1))
Housing_byLA_byyear_stacked
laundry_national <-
facet_plot(hmcare_alldata, quote(Laundry_OV), quote(year)) +
ggtitle("Home care clients receiving Laundry service, by year")
laundry_national
laundry_byLA <-
facet_plot(hmcare_alldata, quote(Laundry_OV), quote(LAcode)) +
ggtitle("Home care clients receiving laundry service, by LA")
laundry_byLA
shopping_national <-
facet_plot(hmcare_alldata, quote(Shopping_OV), quote(year)) +
ggtitle("Home care clients receiving Shopping service, by year")
shopping_national
shopping_byLA <-
facet_plot(hmcare_alldata, quote(Shopping_OV), quote(LAcode)) +
ggtitle("Home care clients receiving Shopping service, by LA")
laundry_byLA
housingsupp_national <-
facet_plot(hmcare_alldata, quote(HousingSupport_OV), quote(year)) +
ggtitle("Home care clients receiving Shopping service, by year")
housingsupp_national
housingsupport_byLA <-
facet_plot(hmcare_alldata, quote(HousingSupport_OV), quote(LAcode)) +
ggtitle("Home care clients receiving Housing Support, by LA")
housingsupport_byLA
hmcare_alldata <-
hmcare_alldata %>%
mutate(other_services = ifelse(Laundry_OV == "Yes" |
Shopping_OV == "Yes"|
HousingSupport_OV == "Yes",
"Yes", "No"))
hmcare_alldata$other_services <- factor(hmcare_alldata$other_services,
levels = c("Yes", "No"),
labels = c("Yes", "No"))
otherservice_nat <-
facet_plot(hmcare_alldata, quote(other_services), quote(year)) +
ggtitle("Other services for Home care clients, by year")
otherservice_nat
otherserv_byLA <-
facet_plot(hmcare_alldata, quote(other_services), quote(LAcode)) +
ggtitle("Other services for home care clients, by LA")
otherserv_byLA
hmcare_telecare <-
hmcare_alldata_simplified %>%
filter(year != "2010")
commalarm_nat <-
facet_plot(hmcare_telecare, quote(communityalarmonly), quote(year)) +
ggtitle("Community alarm for those receiving home care, by year")
commalarm_nat
commalarm_byAgeandGender <-
multifacet_plot(hmcare_telecare, quote(communityalarmonly), quote(GenderISO),
quote(AgeGRP)) +
ggtitle("Community Alarm, Home care cohort, by Age and Gender")
commalarm_byAgeandGender
commalarm_byLA <-
facet_plot(hmcare_telecare, quote(communityalarmonly), quote(LAcode)) +
ggtitle("Community Alarm, Home care cohort, by Local Auhority")
commalarm_byLA
stackstats <-
hmcare_telecare %>%
group_by(LAcode, communityalarmonly) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_commalarm <-
stackstats %>%
arrange(communityalarmonly, -pct)
ordered_LAs <- ordered_commalarm$LAcode[1:32]  #Order by Female over75s
commalarm_byLA_stacked <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = communityalarmonly)) +
geom_col(position = "stack") +
scale_x_discrete(limits = ordered_LAs) +#using above vector
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1)) +
ggtitle("Community alarm only, Home care cohort") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare")
commalarm_byLA_stacked
stackstats <-
hmcare_telecare %>%
group_by(LAcode, communityalarmonly) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_commalarm <-
stackstats %>%
arrange(communityalarmonly, -pct)
ordered_LAs <- ordered_commalarm$LAcode[1:32]  #Order by Female over75s
commalarm_byLA_stacked <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = communityalarmonly)) +
geom_col(position = "stack") +
scale_x_discrete(limits = ordered_LAs) +#using above vector
ggtitle("Community alarm only, Home care cohort") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare") +
theme_economist() +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1))
commalarm_byLA_stacked
telecare_nat <-
facet_plot(hmcare_telecare, quote(telecareonly), quote(year)) +
ggtitle("Telecare for those receiving home care, by year")
telecare_nat
nrow(hmcare_telecare[hmcare_telecare$telecareonly == "Yes",])
telecare_byAgeandGender <-
multifacet_plot(hmcare_telecare,quote(telecareonly), quote(GenderISO),
quote(AgeGRP)) +
ggtitle("Telecare, Home care cohort, by Age and Gender")
telecare_byAgeandGender
telecare_byLA <-
facet_plot(hmcare_telecare, quote(telecareonly), quote(LAcode)) +
ggtitle("Telecare only, Home care cohort, by Local Authority")
telecare_byLA
commandtelecare_nat <-
facet_plot(hmcare_telecare, quote(communityandtelecare), quote(year)) +
ggtitle("Community alarm & Telecare for those receiving home care, by year")
commandtelecare_nat
nrow(hmcare_telecare[hmcare_telecare$communityandtelecare == "Yes",])
commandtelecare_byAgeandGender <-
multifacet_plot(hmcare_telecare,quote(communityandtelecare), quote(GenderISO),
quote(AgeGRP)) +
ggtitle("Community and Telecare, Home care cohort, by Age and Gender")
commandtelecare_byAgeandGender
commandtelecare_byLA <-
facet_plot(hmcare_telecare, quote(communityandtelecare), quote(LAcode)) +
ggtitle("Community and Telecare, Home care cohort, by Local Authority")
commandtelecare_byLA
stackstats <-
hmcare_telecare %>%
group_by(LAcode, communityandtelecare) %>%
summarise(count = n()) %>%
mutate(pct = count/sum(count)*100)
ordered_commandtelecare <-
stackstats %>%
arrange(communityandtelecare, -pct)
ordered_LAs <- ordered_commandtelecare$LAcode[1:32]  #Order by Female over75s
commandtelecare_byLA_stacked <-
ggplot(stackstats, aes(x = LAcode, y = pct, fill = communityandtelecare)) +
geom_col(position = "stack") +
scale_x_discrete(limits = ordered_LAs) +#using above vector
ggtitle("Community and Telecare, Home care cohort") +
xlab("Local Authority") +
ylab("Perecentage receiving homecare") +
theme_economist() +
theme(axis.text.x = element_text(angle = 45, size = 10, hjust = 1, vjust = 1))
commandtelecare_byLA_stacked
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
load("wrangled_datasets.RData")
library(dplyr)
library(ggthemes)
library(forcats)
library(cowplot)
#Define Basic Plot function
basic_plot <- function(df, x){
plotstats <-
df %>%
group_by_(x) %>%
summarise_(count = ~n()) %>%
mutate_(pct = ~count/sum(count)*100)
plot <-
ggplot(df,aes_(x = x)) +
geom_bar() +
geom_text(data = plotstats, aes(label=paste0(round(pct,1),"%"),
y=pct), size=3.5, vjust = -1, colour = "sky blue")
plot
}
#Define facet_plot function
facet_plot <- function(df, x, y){
plotstats <-
df %>%
group_by_(y, x) %>%
summarise_(count = ~n()) %>%
mutate_(pct = ~count/sum(count)*100) %>%
mutate_(yeartot = ~sum(count))
plot <-
ggplot(df,aes_(x = x)) +
geom_bar() +
facet_wrap(y, scales = "free") +
geom_text(data = plotstats, aes(label=paste0(round(pct,1),"%"),
y=pct), size=3.5, vjust = -1,
colour = "sky blue") +
geom_text(data = plotstats,
aes(label=paste0("Total number = ",yeartot), x = Inf, y= Inf),
hjust = 1, vjust = 1, colour = "black") +
theme_economist()
plot
}
#Define multi-facet plot
multifacet_plot <- function(df, x, y, z){
plotstats <-
df %>%
group_by_(y, z, x) %>%
summarise_(count = ~n()) %>%
mutate_(pct = ~count/sum(count)*100) %>%
mutate_(yeartot = ~sum(count))
plot <-
ggplot(df,aes_(x = x)) +
geom_bar() +
facet_grid(as.formula(paste(y,"~", z)), scales = "free") +
geom_text(data = plotstats, aes(label=paste0(round(pct,1),"%"),
y=pct), size=3.5, vjust = -1, colour = "sky blue") +
geom_text(data = plotstats,
aes(label=paste0("Total number = ",yeartot), x = Inf, y= Inf),
hjust = 1, vjust = 1, colour = "black") +
theme_economist()
plot
}
hmcare_alldata <-
hmcare_alldata %>%
filter(!is.na(AgeGRP)) %>%
filter(!is.na(bandHRSvol))
hmcare_sc10 <-
hmcare_sc10 %>%
filter(!is.na(AgeGRP)) %>%
filter(!is.na(bandHRSvol))
hmcare_sc11 <-
hmcare_sc11 %>%
filter(!is.na(AgeGRP)) %>%
filter(!is.na(bandHRSvol))
hmcare_sc12 <-
hmcare_sc12 %>%
filter(!is.na(AgeGRP)) %>%
filter(!is.na(bandHRSvol))
age_by_year <-
facet_plot(hmcare_alldata, quote(AgeGRP), quote(year)) +
ggtitle("Count of Age Group by year")
age_by_year
View(hmcare_alldata)
library(nnet)
mutifit <- multinom(AgeGRP ~ GenderISO, data = hmcare_alldata)
summary(multifit)
summary(mutifit)
